from config.db_config import get_db_connection

class VulnerabilityModel:
    def __init__(self):
        self.conn = get_db_connection()
        self.create_table()

    def create_table(self):
        query = """
        CREATE TABLE IF NOT EXISTS vulnerabilities (
            VulnerabilityID INT PRIMARY KEY AUTO_INCREMENT,
            CVE_ID INT NOT NULL,
            Description TEXT NOT NULL,
            SeverityLevel VARCHAR(50) NOT NULL
        )
        """
        cursor = self.conn.cursor()
        cursor.execute(query)
        self.conn.commit()

    def add_vulnerability(self, cve_id, severity, description):
        query = "INSERT INTO vulnerabilities (CVE_ID, SeverityLevel, Description) VALUES (%s, %s, %s)"
        cursor = self.conn.cursor()
        cursor.execute(query, (cve_id, severity, description))
        self.conn.commit()

    def get_all_vulnerabilities(self):
        query = "SELECT * FROM vulnerabilities"
        cursor = self.conn.cursor()
        cursor.execute(query)
        return cursor.fetchall()

    def update_vulnerability(self,vulnerability_id, cve_id, severity, description):
        query = "UPDATE vulnerabilities SET CVE_ID=%s, SeverityLevel=%s, Description=%s WHERE VulnerabilityID=%s"
        cursor = self.conn.cursor()
        cursor.execute(query, (cve_id, severity, description, vulnerability_id))
        self.conn.commit()

    def delete_vulnerability(self, vulnerability_id):
        query = "DELETE FROM vulnerabilities WHERE VulnerabilityID=%s"
        cursor = self.conn.cursor()
        cursor.execute(query, (vulnerability_id,))
        self.conn.commit()
